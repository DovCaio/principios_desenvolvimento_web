generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// ENUMS
//
enum UserType {
  RESIDENT
  VISITOR
  EMPLOYEE
}

enum EmployeeType {
  LeisureAreaEmployee
  GateEmployee
}

enum ServiceStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum ServiceType {
  MAINTENANCE
  CLEANING
  COMMON_AREA
  OTHER
}

//
// MODELS
//

model User {
  cpf         String    @id
  password    String    
  phone       String    @unique
  name        String
  userType    UserType

  resident    Resident?
  employee    Employee?
  visitor     Visitor?

  schedulings     Scheduling[]
  serviceRequests ServiceRequest[]
}

model Resident {
  id            Int     @id @default(autoincrement())

  lotId         Int?
  lot           Lot?    @relation("LotResidents", fields: [lotId], references: [id])

  responsibleFor Lot?     @relation("LotResponsible")

  userCpf       String  @unique
  user          User    @relation(fields: [userCpf], references: [cpf])
}

model Employee {
  id            Int          @id @default(autoincrement())

  employeeType  EmployeeType

  userCpf       String       @unique
  user          User         @relation(fields: [userCpf], references: [cpf])
}

model Visitor {
  id          Int      @id @default(autoincrement())

  lotId       Int?
  lot         Lot?     @relation("LotVisitors", fields: [lotId], references: [id])

  userCpf     String   @unique
  user        User     @relation(fields: [userCpf], references: [cpf])
}

model Lot {
  id            Int       @id @default(autoincrement())
  intercom      String

  responsibleId Int?       @unique
  responsible   Resident?  @relation("LotResponsible", fields: [responsibleId], references: [id])

  residents     Resident[] @relation("LotResidents")
  visitors      Visitor[]  @relation("LotVisitors")
  
  serviceRequests ServiceRequest[]
}

model LeisureArea {
  id           Int          @id @default(autoincrement())
  name         String       
  capacity     Int
  
  schedulings  Scheduling[] 
}

model Scheduling {
  id            Int         @id @default(autoincrement())
  startTime     DateTime
  endTime       DateTime
  
  userCpf       String
  user          User        @relation(fields: [userCpf], references: [cpf])
  
  leisureAreaId Int
  leisureArea   LeisureArea @relation(fields: [leisureAreaId], references: [id])
}

model ServiceRequest {
  id            Int           @id @default(autoincrement())
  description   String
  type          ServiceType
  status        ServiceStatus @default(PENDING)
  
  requesterCpf  String
  requester     User          @relation(fields: [requesterCpf], references: [cpf])

  targetLotId   Int?
  targetLot     Lot?          @relation(fields: [targetLotId], references: [id])

  createdAt     DateTime      @default(now())
}